/**
 * @file js templete
 * @author xucaiyu
 * @email 569455187@qq.com
 * @version 1.0.0
 * @date 2014-11-26
 * @license MIT License 
 */
!function(){var e={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&#x27;","/":"&#x2f;"},t={},n=function(t){return e[t]},r=function(e){return"string"!=typeof e?e:e.replace(/[&<>"']+/gim,n)},o=Array.isArray||function(e){return"[object Array]"==={}.toString.call(e)},a=function(e,t,n,r){var a,i;if(o(e))for(a=t,i=n;i>a;a++)r.call(e,e[a],a,e);else for(a in e)r.call(e,e[a],a)},i=function(e,t){if(e){var n=new Date(e),r={"M+":n.getMonth()+1,"d+":n.getDate(),"h+":n.getHours()%12==0?12:n.getHours()%12,"H+":n.getHours(),"m+":n.getMinutes(),"s+":n.getSeconds(),"q+":Math.floor((n.getMonth()+3)/3),S:n.getMilliseconds()},o={0:"日",1:"一",2:"二",3:"三",4:"四",5:"五",6:"六"};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(n.getFullYear()+"").substr(4-RegExp.$1.length))),/(E+)/.test(t)&&(t=t.replace(RegExp.$1,(RegExp.$1.length>1?RegExp.$1.length>2?"星期":"周":"")+o[n.getDay()+""]));for(var a in r)new RegExp("("+a+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?r[a]:("00"+r[a]).substr((""+r[a]).length)));return t}},s=function(e){return e?String(e).replace(/\B(?=(?:\d{3})+$)/g,","):void 0},c=function(e){var t=typeof e;if("string"===t)return e.length;if("object"===t){var n=0;for(var r in e)n++;return n}return!1},l=function(e,t){if("string"!=typeof e)throw"Template not found";var n=l._parse.call(l,e);return void 0===t?n:n.render(t)},u=l.tools={_escape_:r,_each_:a,count:c,date_format:i,number_format:s};l.tags={langOpen:"{{",langClose:"}}",varOpen:"\\${",varClose:"}",commentOpen:"<!--",commentClose:"-->"},l.statement={"if":function(e){return"if("+e+"){"},"else if":function(e){return"}else if("+e+"){"},"else":function(){return"}else{"},"/if":function(){return"}"},"for":function(e,t){var n="",r=t&&/\d+/.test(t.split(",")[0]);return n=r===!1?"_each_("+e+",0,"+e+".length,function("+t+"){":r?"_each_([],"+t+",function($value,"+e+"){":"_each_("+e+",0,"+e+".length,function($value,$index){"},"/for":function(){return"});"},log:function(e){return"console.log("+e+");"}},l._compile=function(e){function t(e){var t;e&&!_[e]&&(t=u[e]?"$tools."+e:"$data."+e,g+=e+"="+t+",",_[e]=!0)}var n,r="\\s*(\\/?\\w+(?:\\s*if)?)\\s*(?:([^\\"+l.tags.langClose+"\\(]*)(?:\\(([\\d\\w,]*)\\))?)\\s*",o=l.tags.langOpen+r+l.tags.langClose,a=l.tags.varOpen+"([=\\s]?)([^\\|]+?)(?:\\|([\\s\\S]+?))?"+l.tags.varClose,i=l.tags.commentOpen+"[\\s\\S]*"+l.tags.commentClose,s=new RegExp(o,"igm"),c=new RegExp(a,"igm"),f=new RegExp(i,"igm"),g="",p="",_={};return n=e.replace(f,"").replace(s,function(e,t,n,r){var o=l.statement[t];if(!o)throw"Unknown template tag: "+t;return"'; "+o(n,r)+" _str+='"}).replace(c,function(e,n,r,o){if("="!==n&&(r="_escape_("+r+")"),o){var a=o.split(":"),i=a[0].replace(/\s/g,""),s=a[1]||void 0;r=i+"("+r+","+s+")",t(i)}return"'+"+r+"+'"}).replace(/[\r\t\n]/g,""),g="var _escape_=$tools._escape_,_each_=$tools._each_,"+g,p="_str = '';_str+='"+n+"'; return new String(_str);",function(e){var t,n="";return u._each_(e,0,0,function(e,t){n+=t+"=$data."+t+","}),t=g+n+p,new Function("$data, $tools",t)(e,u)}},l._parse=function(e){function n(){this._tpl=r,this.render=function(e){try{return this._tpl(e).replace(/(^\s*)|(\s*$)/g,"")}catch(t){throw t}}}var r;return t[e]?r=t[e]:(r=this._compile(e),t[e]=r),new n},"function"==typeof define?define(function(){return l}):"undefined"!=typeof exports?module.exports=l:window.fasTpl=l}();