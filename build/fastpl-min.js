/**
 * @file js template
 * @author xucaiyu
 * @email 569455187@qq.com
 * @version 3.0
 * @date 2015-03-30
 * @license MIT License 
 */
!function(){function e(e,t){return e?e:t}var t={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&#x27;","/":"&#x2f;"},n={},r=function(e){return t[e]},o=function(e){return"string"!=typeof e?e:e.replace(/[&<>"']+/gim,r)},a=Array.isArray||function(e){return"[object Array]"==={}.toString.call(e)},i=function(e,t,n,r){var o,i;if(a(e))for(o=t,i=n;i>o;o++)r.call(e,e[o],o,e);else for(o in e)r.call(e,e[o],o)},s=function(e,t){if(e){var n=new Date(e.replace(/\-/g,"/")),r={"M+":n.getMonth()+1,"d+":n.getDate(),"h+":n.getHours()%12==0?12:n.getHours()%12,"H+":n.getHours(),"m+":n.getMinutes(),"s+":n.getSeconds(),"q+":Math.floor((n.getMonth()+3)/3),S:n.getMilliseconds()},o={0:"日",1:"一",2:"二",3:"三",4:"四",5:"五",6:"六"};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(n.getFullYear()+"").substring(4-RegExp.$1.length))),/(E+)/.test(t)&&(t=t.replace(RegExp.$1,(RegExp.$1.length>1?RegExp.$1.length>2?"星期":"周":"")+o[n.getDay()+""]));for(var a in r)new RegExp("("+a+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?r[a]:("00"+r[a]).substring((""+r[a]).length)));return t}},l=function(e){return e?String(e).replace(/\B(?=(?:\d{3})+$)/g,","):void 0},c=function(e){var t=typeof e;if("string"===t)return e.length;if("object"===t){var n=0;for(var r in e)n++;return n}return!1},u=function(e,t){if("string"!=typeof e)throw"Template not found";var n=u._parse.call(u,e);return void 0===t?n:n.render(t)},f={_escape_:o,_each_:i,_ifEmpty_:e,count:c,date_format:s,number_format:l};u.tools=function(e,t){if("object"==typeof e)for(var n in e)f[n]=e[n];else f[e]=t},u.getTools=function(){return f},u.tags={langOpen:"{{",langClose:"}}",varOpen:"\\${",varClose:"}",commentOpen:"<!--",commentClose:"-->"},u.version="3.0",u.uid="1",u.statement={"var":function(e){return"var "+e+";"},"if":function(e){return"if("+e+"){"},"else if":function(e){return"}else if("+e+"){"},"else":function(){return"}else{"},"/if":function(){return"}"},"for":function(e){var t,n,r="",e=e.replace(/\s/g,""),o=e.split("("),a=o[0],i=o[1]?o[1]:"";return""===i?r="_each_("+a+",0,"+a+".length,function(v, i){":""!==i?(t=i.split(")")[0].split(","),n=/\d+/.test(t[0])||/\d+/.test(t[1]),r=n?"_each_([],"+t+",function(data,"+(a?a:"i")+"){":"_each_("+a+",0,"+a+".length,function("+t+"){"):r="for"+e,r},"/for":function(){return"});"},log:function(e){return"console.log("+e+");"}},u._compile=function(e){function t(e){var t;e&&!v[e]&&(t=f[e]?"$tools."+e:"_data."+e,_+=e+"="+t+",",v[e]=!0)}var n,r="\\s*(\\/?\\w+(?:\\s*if)?)\\s*([^"+u.tags.langClose+"]*)",o=u.tags.langOpen+"literal"+u.tags.langClose+"([\\s\\S]*)"+u.tags.langOpen+"/literal"+u.tags.langClose,a=u.tags.langOpen+r+u.tags.langClose,i=u.tags.varOpen+"([=\\s]?)([^\\|]+?)\\s*(?:(\\|+)([\\s\\S]+?))?"+u.tags.varClose,s=u.tags.commentOpen+"[\\s\\S]*"+u.tags.commentClose,l=new RegExp(o,"igm"),c=new RegExp(a,"igm"),g=new RegExp(i,"igm"),p=new RegExp(s,"igm"),_="var _escape_=$tools._escape_,_each_=$tools._each_,_ifEmpty_=$tools._ifEmpty_,",m="",v={};return n=e.replace(/[\r\t\n]/g,"").replace(p,"").replace(l,function(e,t){var n="_literal_"+u.uid++;return _+=n+"='"+t+"',","';_str+="+n+"+'"}).replace(c,function(e,t,n){var r=u.statement[t];if(!r)throw"Unknown template tag: "+t;return"'; "+r(n)+" _str+='"}).replace(g,function(e,n,r,o,a){if("||"==o&&(-1===r.indexOf(".")&&t(r),r="_ifEmpty_("+r+","+a+")"),"="!==n&&(r="_escape_("+r+")"),"|"==o&&a){var i=a.split(":"),s=i[0].replace(/\s/g,""),l=i[1]||void 0;r=s+"("+r+","+l+")",t(s)}return"'+"+r+"+'"}).replace(/[\r\t\n]/g,""),m="_str = '';_str+='"+n+"'; return new String(_str);",function(e){var t,n="";return f._each_(e,0,0,function(e,t){n+=t+"=_data."+t+","}),t=_+n+m,new Function("_data, $tools",t)(e,f)}},u._parse=function(e){function t(){this._tpl=r,this.render=function(e){try{return this._tpl(e).replace(/(^\s*)|(\s*$)/g,"")}catch(t){throw t}}}var r;return n[e]?r=n[e]:(r=this._compile(e),n[e]=r),new t},"function"==typeof define?define(function(){return u}):"undefined"!=typeof exports?module.exports=u:window.fasTpl=u}();