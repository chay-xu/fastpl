/**
 * @file js templete
 * @author xucaiyu
 * @email 569455187@qq.com
 * @version 1.0.0
 * @date 2014-11-26
 * @license MIT License 
 */
!function(){var e={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&#x27;","/":"&#x2f;"},t={},n=function(t){return e[t]},r=function(e){if("string"!=typeof e)return e;var t=e.replace(/[&<>"']+/gim,n);return t},o=Array.isArray||function(e){return"[object Array]"==={}.toString.call(e)},a=function(e,t,n,r){var a=t,s=n;if(o(e))for(;s>a;a++)r.call(e,e[a],a,e);else for(a in e)r.call(e,e[a],a)},s=function(e,t){if(e){var n=new Date(e),r={"M+":n.getMonth()+1,"d+":n.getDate(),"h+":n.getHours()%12==0?12:n.getHours()%12,"H+":n.getHours(),"m+":n.getMinutes(),"s+":n.getSeconds(),"q+":Math.floor((n.getMonth()+3)/3),S:n.getMilliseconds()},o={0:"日",1:"一",2:"二",3:"三",4:"四",5:"五",6:"六"};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(n.getFullYear()+"").substr(4-RegExp.$1.length))),/(E+)/.test(t)&&(t=t.replace(RegExp.$1,(RegExp.$1.length>1?RegExp.$1.length>2?"星期":"周":"")+o[n.getDay()+""]));for(var a in r)new RegExp("("+a+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?r[a]:("00"+r[a]).substr((""+r[a]).length)));return t}},i=function(e){return e?e.replace(/\B(?=(?:\d{3})+$)/g,","):void 0},u=function(e){var t=typeof e;if("string"===t)return e.length;if("object"===t){var n=0;for(var r in e)n++;return n}return!1},c=function(e){this._parse(e)},l=c.tools={_escape_:r,_each_:a,count:u,date_format:s,number_format:i};c.tags={langOpen:"{{",langClose:"}}",varOpen:"\\${",varClose:"}",commentOpen:"<!--",commentClose:"-->"},c.statement={"if":function(e){return"if("+e+"){"},"else if":function(e){return"}else if("+e+"){"},"else":function(){return"}else{"},"/if":function(){return"}"},"for":function(e,t){var n="";return isNum=t&&/\d+/.test(t.split(",")[0]),n=isNum===!1?"_each_("+e+",0,"+e+".length,function("+t+"){":isNum?"_each_([],"+t+",function($value,"+e+"){":"_each_("+e+",0,"+e+".length,function($value,$index){"},"/for":function(){return"});"},log:function(e){return"console.log("+e+");"}},c.pt=c.prototype,c.pt._compile=function(e){function t(e){p[e]||(l[e]&&(code="$tools."+e),g+=e+"="+code+",",p[e]=!0)}var n,r="\\s*(\\/?\\w+(?:\\s*if)?)\\s*(?:([^\\"+c.tags.langClose+"\\(]*)(?:\\(([\\d\\w,]*)\\))?)\\s*",o=c.tags.langOpen+r+c.tags.langClose,a=c.tags.varOpen+"([=\\s]?)([^\\|]+?)(?:\\|([\\s\\S]+?))?"+c.tags.varClose,s=c.tags.commentOpen+"[\\s\\S]*"+c.tags.commentClose,i=new RegExp(o,"igm"),u=new RegExp(a,"igm"),f=new RegExp(s,"igm"),g="",p={};return n=e.replace(f,"").replace(i,function(e,t,n,r){var o=c.statement[t];if(!o)throw"Unknown template tag: "+t;return"'; "+o(n,r)+" _str+='"}).replace(u,function(e,n,r,o){if("="!==n&&(r="_escape_("+r+")"),o){var a=o.split(":"),s=a[0].replace(/\s/g,""),i=a[1]||void 0;r=s+"("+r+","+i+")",t(s)}return"'+"+r+"+'"}).replace(/[\r\t\n]/g,""),n="var _escape_=$tools._escape_,_each_=$tools._each_,"+g+"_str = '';with($data){ _str+='"+n+"'}; return new String(_str);"},c.pt._parse=function(e){if(t[e])var n=t[e];else{var n=this._compile(e);t[e]=n}try{this._tpl=new Function("$data, $tools",n)}catch(r){throw r}return this},c.pt.render=function(e){var t=this._tpl(e,l).replace(/(^\s*)|(\s*$)/g,"");return t};var f=function(e,t){if("string"!=typeof e)throw"Template not found";var n=new c(e,t);return void 0===t?n:n.render(t)};"function"==typeof define?define(function(){return f}):"undefined"!=typeof exports?module.exports=f:window.fasTpl=f}();